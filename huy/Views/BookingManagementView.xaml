<UserControl x:Class="huy.Views.BookingManagementView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:viewmodels="clr-namespace:huy.ViewModels"
             xmlns:converters="clr-namespace:huy.Converters">
    
    <UserControl.DataContext>
        <viewmodels:BookingViewModel />
    </UserControl.DataContext>
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Title and Filter Buttons -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="Booking Management" FontSize="20" FontWeight="Bold" Margin="0,0,0,10"/>
            
            <StackPanel Grid.Column="1" Orientation="Horizontal">
                <Button Content="All" Command="{Binding FilterAllCommand}" Width="80" Margin="0,0,10,0"/>
                <Button Content="Online" Command="{Binding FilterOnlineCommand}" Width="80" Margin="0,0,10,0"/>
                <Button Content="Offline" Command="{Binding FilterOfflineCommand}" Width="80"/>
            </StackPanel>
        </Grid>
        
        <!-- Search Panel -->
        <Grid Grid.Row="1" Margin="0,0,0,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <StackPanel Grid.Column="0" Orientation="Horizontal">
                <TextBlock Text="Search:" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBox Width="250" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,10,0"/>
                <Button Content="Search" Command="{Binding SearchCommand}" Width="80" Margin="0,0,10,0"/>
                <Button Content="Refresh" Command="{Binding RefreshCommand}" Width="80"/>
            </StackPanel>
        </Grid>
        
        <!-- Booking List and Form -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>
            
            <!-- Booking DataGrid -->
            <DataGrid Grid.Column="0" ItemsSource="{Binding Bookings}" 
                      SelectedItem="{Binding SelectedBooking}" 
                      AutoGenerateColumns="False" 
                      IsReadOnly="True"
                      SelectionMode="Single"
                      BorderThickness="1"
                      BorderBrush="Gray"
                      Margin="0,0,10,0">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="ID" Binding="{Binding BookingReservationID}" Width="50"/>
                    <DataGridTextColumn Header="Customer" Binding="{Binding Customer.CustomerFullName}" Width="150"/>
                    <DataGridTextColumn Header="Room" Binding="{Binding Room.RoomNumber}" Width="80"/>
                    <DataGridTextColumn Header="Booking Date" Binding="{Binding BookingDate, StringFormat=\{0:dd/MM/yyyy\}}" Width="100"/>
                    <DataGridTextColumn Header="Check-in" Binding="{Binding StartDate, StringFormat=\{0:dd/MM/yyyy\}}" Width="100"/>
                    <DataGridTextColumn Header="Check-out" Binding="{Binding EndDate, StringFormat=\{0:dd/MM/yyyy\}}" Width="100"/>
                    <DataGridTextColumn Header="Duration" Binding="{Binding BookingDuration}" Width="70"/>
                    <DataGridTextColumn Header="Total Price" Binding="{Binding TotalPrice, StringFormat=\{0:C\}}" Width="100"/>
                    <DataGridTextColumn Header="Type" Binding="{Binding BookingType, Converter={StaticResource BookingTypeConverter}}" Width="80"/>
                    <DataGridTextColumn Header="Status" Binding="{Binding BookingStatus, Converter={StaticResource BookingStatusConverter}}" Width="80"/>
                </DataGrid.Columns>
            </DataGrid>
            
            <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Center" VerticalAlignment="Stretch"/>
            
            <!-- Booking Form -->
            <Border Grid.Column="2" BorderBrush="Gray" BorderThickness="1" Padding="10">
                <StackPanel>
                    <TextBlock Text="{Binding IsEditing, Converter={StaticResource BoolToStringConverter}, ConverterParameter='Edit Booking;Add New Booking'}" 
                               FontWeight="Bold" FontSize="16" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Customer:" Margin="0,5,0,0"/>
                    <ComboBox ItemsSource="{Binding Customers}" 
                              DisplayMemberPath="CustomerFullName"
                              SelectedValuePath="CustomerID"
                              SelectedValue="{Binding NewBooking.CustomerID}"
                              Margin="0,0,0,5"/>
                    
                    <TextBlock Text="Room:" Margin="0,5,0,0"/>
                    <ComboBox ItemsSource="{Binding AvailableRooms}" 
                              SelectedValuePath="RoomID"
                              SelectedValue="{Binding NewBooking.RoomID}"
                              Margin="0,0,0,5">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock>
                                        <Run Text="{Binding RoomNumber}" FontWeight="Bold"/>
                                        <Run Text=" - "/>
                                        <Run Text="{Binding RoomType.RoomTypeName}"/>
                                        <Run Text=" ("/>
                                        <Run Text="{Binding RoomPricePerDate, StringFormat=\{0:C\}}"/>
                                        <Run Text="/day)"/>
                                    </TextBlock>
                                    <Border Background="#4CAF50" CornerRadius="3" Margin="10,0,0,0" Padding="5,1">
                                        <TextBlock Text="Available" Foreground="White" FontSize="10" FontWeight="Bold"/>
                                    </Border>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                    
                    <TextBlock Text="Check-in Date:" Margin="0,5,0,0"/>
                    <DatePicker SelectedDate="{Binding StartDate}" Margin="0,0,0,5"/>
                    
                    <TextBlock Text="Check-out Date:" Margin="0,5,0,0"/>
                    <DatePicker SelectedDate="{Binding EndDate}" Margin="0,0,0,5"/>
                    
                    <Button Content="Check Availability" Command="{Binding RefreshCommand}" 
                            Background="#3498db" Foreground="White" Padding="10,5"
                            BorderThickness="0" Margin="0,0,0,10"/>
                    
                    <TextBlock Text="Booking Type:" Margin="0,5,0,0"/>
                    <ComboBox SelectedIndex="{Binding NewBooking.BookingType, Converter={StaticResource BookingTypeToIndexConverter}}" 
                              Margin="0,0,0,5">
                        <ComboBoxItem Content="Online"/>
                        <ComboBoxItem Content="Offline"/>
                    </ComboBox>
                    
                    <TextBlock Text="Status:" Margin="0,5,0,0"/>
                    <ComboBox SelectedIndex="{Binding NewBooking.BookingStatus, Converter={StaticResource BookingStatusToIndexConverter}}" 
                              Margin="0,0,0,5">
                        <ComboBoxItem Content="Active"/>
                        <ComboBoxItem Content="Completed"/>
                        <ComboBoxItem Content="Cancelled"/>
                    </ComboBox>
                    
                    <Grid Margin="0,5,0,5">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <TextBlock Grid.Row="0" Grid.Column="0" Text="Duration:" Margin="0,0,10,0"/>
                        <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding NewBooking.BookingDuration}" Margin="0,0,0,5"/>
                        
                        <TextBlock Grid.Row="1" Grid.Column="0" Text="Total Price:" Margin="0,0,10,0"/>
                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding NewBooking.TotalPrice, StringFormat=\{0:C\}}" Margin="0,0,0,5"/>
                    </Grid>
                    
                    <TextBlock Text="{Binding ErrorMessage}" Foreground="Red" TextWrapping="Wrap" Margin="0,0,0,10"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                        <Button Content="Save" Command="{Binding SaveCommand}" Width="80" Margin="0,0,10,0"/>
                        <Button Content="Cancel" Command="{Binding CancelCommand}" Width="80" Margin="0,0,10,0"/>
                        <Button Content="Delete" Command="{Binding DeleteCommand}" Width="80"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- Action Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
            <Button Content="Add New Booking" Command="{Binding AddCommand}" Width="150"/>
        </StackPanel>
    </Grid>
</UserControl> 